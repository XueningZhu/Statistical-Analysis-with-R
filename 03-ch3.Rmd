# 第3章：基本统计分析 {-}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = F, warning = F, cache = T)
```

```{r}
rm(list = ls())#清理工作空间
tenement = read.csv("./data/rent.csv",fileEncoding = "gbk",stringsAsFactors = FALSE)#导入数据
```

## 3.1 基本描述统计量 {-}

以下从频数统计开始，一一介绍均值、分位数、方差、标准差、最大最小值、峰度、偏度等基本统计量。

### 3.1.1 频数统计{-}

频数（freguency）统计是对定性变量的各水平计数进行统计的描述统计量。

```{r}
(type<- table(tenement$region))#频数统计
tenement$regiontype=tenement$region#设置新变量
tenement[!is.element(tenement$region,c("朝阳","通州","昌平","丰台")),]$regiontype="其他"#将非朝阳、通州、昌平和丰台的租赁房间合并为为其他
sort(table(tenement$regiontype))
```


### 3.1.2 均值{-}

均值（mean），即一组数值型数据的平均数，是最常用的统计量之一。

```{r}
mean(tenement$rent)#求房租均值
tenement_num=tenement[c("rent","area")]#选取数值型子集
colMeans(tenement_num)#同时计算列和
```

### 3.1.3 分位数{-}

在数据分布偏度较大的情况下，均值并不能很好地反映数据的一般水平。此时，可使用中位数（median）刻画数据的一般情形。中位数是分位数（quantile）的一个特殊情况。

```{r}
median(tenement$rent)#求租金的中位数
quantile(tenement$rent, probs = 0.5)#利用quantile()函数求中位数
quantile(tenement$rent, probs = seq(0, 1, 0.25))#求向量最小值、最大值、四分位数
```

### 3.1.4 方差和标准差{-}

方差（variance）和标准差（standard deviation）是描述一组数值型数据的分散程度的描述统计量。协方差（covariance）和相关系数（correlation coefficient）是描述变量相关程度的描述统计量。

```{r}
mean(tenement$rent[tenement$regiontype == "昌平"])#昌平区租金均值
var(tenement$rent[tenement$regiontype == "昌平"])#昌平区租金方差
mean(tenement$rent[tenement$regiontype == "其他"])#其他区租金均值
var(tenement$rent[tenement$regiontype == "其他"])#其他区租金方差


sd(tenement$rent[tenement$regiontype == "昌平"])#昌平区租金标准差
sd(tenement$rent[tenement$regiontype == "其他"])#其他区租金标准差
cov(tenement$rent, tenement$area)#协方差
cor(tenement$rent, tenement$area)#相关系数

cov(tenement_num)#协方差矩阵
cor(tenement_num)#相关系数矩阵

```

### 3.1.5 最大值、最小值{-}

最大值（maximum value）、最小值（minimum value）描述一组数值型变量由高到低排序后最大和最小的元素。

```{r}
max(tenement$rent)#租金最高值
min(tenement$rent)#租金最低值
a=which.max(tenement$rent)#找出租金最高的房间对应数据所在行
tenement[a,]#输出这一行的内容

```

### 3.1.6 峰度和偏度{-}

偏度（skewness）和峰度（kurtosis）是一组用于描述数据分布形态的统计量。

```{r,eval=FALSE}
library(e1071)#加载包
```
```{r,include=FALSE}
library(e1071)#加载包
```

```{r}
skewness(tenement$rent)#用e1071包求租金的偏度
kurtosis(tenement$rent) #用e1071包求租金的峰度
```

## 3.2 交叉分组下的频数分析{-}

```{r}
rm(list = ls())#清理工作空间
tenement = read.csv("./data/rent.csv",fileEncoding = "gbk",stringsAsFactors = FALSE)#导入数据
```

### 3.2.1 交叉列联表 {-}

交叉列联表(contingency table)是对两个类别变量每个交叉水平下的频数统计。交叉列联表可以展示两个类别变量之间的相关关系。

```{r}
tenement$regiontype=tenement$region#设置新变量
tenement[!is.element(tenement$region,c("朝阳","通州","昌平","丰台")),]$regiontype="其他"#将非朝阳、通州、昌平和丰台的租赁房间合并为为其他

(tab <- table(tenement$regiontype,tenement$floor_grp))#建立城区和楼层的交叉列联表
prop.table(tab)#频率形式交叉列联表
margin.table(tab,1)#求行变量边际函数
margin.table(tab,2)#求列变量边际函数
addmargins(tab)#添加边际和
```

### 3.2.2 描述统计量的分组统计{-}

描述统计量的分组统计是指对定量变量按照类别变量各取值水平分组后，进行描述统计的操作。

```{r,include=FALSE}
library(dplyr)
```
```{r}
library(dplyr)
tenement_group<-group_by(tenement,regiontype,floor_grp)
summarise(tenement_group,
          meanrent=mean(rent),#分组计算平均平均租金
          maxrent=max(rent),#分组计算最高租金
          minrent=min(rent))#分组计算最低租金
```

## 习题答案{-}

```{r}
tenement = read.csv("./data/rent.csv",fileEncoding = "gbk",stringsAsFactors = FALSE)#导入数据
```

### 题目 3.1 {-}

请求出租房数据集中租赁房间面积（area）的偏度和峰值，并作出简要分析。

```{r}
library(fBasics)
skewness(tenement$area) #用fBasics包求评分的偏度
kurtosis(tenement$area) #用fBasics包求评分的峰度
```
分析：面积的偏度为1.03，说明面积是一个右偏分布；面积的峰度为1.07，说明标准化后的面积分布比正态分布更尖锐，尾部更粗。

### 题目 3.2 {-}

请求出向量城区(region)和供暖方式(heating)的交叉列联表的频率形式,并添加边际和，给出简要解读。
```{r}
tab <- table(tenement$region,tenement$heating)#建立城区和供暖方式的交叉列联表
p_tab <- prop.table(tab)#频率形式交叉列联表
addmargins(p_tab)#添加边际和
```
分析：租赁房间的供暖方式以集中供暖为主，自采暖为辅。不同城区中，朝阳区房源数量最多。朝阳区的集中供暖房源占比最大。

### 题目 3.3 {-}

利用租房数据集，通过分组统计求出每个城区的平均租金并简要解读。

```{r,eval=FALSE}
library(dplyr)
```


```{r,include=FALSE}
library(dplyr)
```

```{r}
tenement%>%group_by(region)%>%
  summarise(meanrent=mean(rent))#平均租金
```

分析：西城区的房源平均租金最高，为3785元；房山区的房源平均租金最低，为1752元。

### 题目 3.4 {-}

利用租房数据集，通过分组统计计算出不同城区房源的平均租赁面积、最大租赁面积和最小租赁面积并简要解读。
```{r}
library(dplyr)
tenement%>%group_by(region)%>%
  summarise(meanarea=mean(area),
            maxarea=max(area),
            minarea=min(area))
```
分析：石景山区房源的平均租赁面积最大，为13.7平米，房山区房源的平均租赁面积最小，为11.9平米；最大租赁面积为30平米，分别在昌平区和通州区；最小租赁面积为5平米，分别在朝阳区和通州区。
